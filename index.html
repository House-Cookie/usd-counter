<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contador de Saldo</title>

    <link rel="manifest" href="manifest.json">

    <meta name="theme-color" content="#f8f9fa"/>
    
    <style>
        /* (Pego el mismo CSS de antes, no necesita cambios) */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
        }

        .contador-app {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100vh;
            background-color: #ffffff;
            margin: 0;
            padding: 0;
            box-shadow: none;
            overflow: hidden;
        }

        .saldo-section {
            background-color: #f8f9fa;
            padding: 24px 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            z-index: 10;
        }
        
        h2 { text-align: center; margin-top: 0; margin-bottom: 15px; color: #333; }
        .saldo-container { display: flex; align-items: center; justify-content: center; margin: 20px 0; gap: 15px; }
        .signo-dolar { font-size: clamp(2.5em, 10vw, 3.5em); font-weight: 300; color: #555; }
        #saldo-display { font-size: clamp(2.5em, 10vw, 3.5em); font-weight: 700; color: #2c3e50; background: #ecf0f1; padding: 10px 20px; border-radius: 8px; min-width: 120px; text-align: right; box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05); }
        .controles { display: flex; justify-content: center; gap: 20px; margin-bottom: 10px; }
        .btn { font-size: 1.8em; font-weight: bold; border: none; border-radius: 50%; width: 55px; height: 55px; cursor: pointer; transition: all 0.2s ease; color: white; display: grid; place-items: center; }
        #btn-agregar { background-color: #2ecc71; }
        #btn-agregar:hover { background-color: #27ae60; }
        #btn-restar { background-color: #e74c3c; }
        #btn-restar:hover { background-color: #c0392b; }

        .historial-section { padding: 20px; flex-grow: 1; overflow-y: auto; background-color: #ffffff; }
        .historial-section h3 { margin-top: 0; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        #historial-lista { list-style: none; padding: 0; margin: 0; }
        #historial-lista li { padding: 12px 10px; border-bottom: 1px solid #eee; font-size: 0.95em; }
        #historial-lista li:last-child { border-bottom: none; }
        .agregado { color: #27ae60; background-color: #f0fdf4; }
        .restado { color: #c0392b; background-color: #fef2f2; }
        .fecha-historial { display: block; font-size: 0.8em; color: #777; margin-top: 4px; }

        @media (min-width: 600px) {
            body { display: grid; place-items: center; height: 100vh; }
            .contador-app { width: 90%; max-width: 450px; height: 85vh; max-height: 700px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1); border: 1px solid #eee; }
        }
    </style>
</head>
<body>

    <div class="contador-app">
        
        <div class="saldo-section">
            <h2>Contador de Saldo</h2>
            <div class="saldo-container">
                <span class="signo-dolar">$</span>
                <span id="saldo-display">0.00</span>
            </div>
            <div class="controles">
                <button id="btn-agregar" class="btn" title="Agregar Saldo">+</button>
                <button id="btn-restar" class="btn" title="Restar Saldo">-</button>
            </div>
        </div>
        
        <div class="historial-section">
            <h3>Historial de Transacciones</h3>
            <ul id="historial-lista">
                </ul>
        </div>

    </div>

    <script>
        // (Pego el mismo JavaScript de antes, no necesita cambios)
        document.addEventListener('DOMContentLoaded', () => {
            const saldoDisplay = document.getElementById('saldo-display');
            const btnAgregar = document.getElementById('btn-agregar');
            const btnRestar = document.getElementById('btn-restar');
            const historialLista = document.getElementById('historial-lista');
            let saldoActual = parseFloat(localStorage.getItem('contadorSaldo')) || 0;
            let historial = JSON.parse(localStorage.getItem('contadorHistorial')) || [];
            function actualizarUI() {
                saldoDisplay.textContent = saldoActual.toFixed(2);
                historialLista.innerHTML = '';
                if (historial.length === 0) {
                    historialLista.innerHTML = '<li style="color: #777; background: none;">No hay transacciones.</li>';
                }
                for (let i = historial.length - 1; i >= 0; i--) {
                    const item = historial[i];
                    const li = document.createElement('li');
                    li.classList.add(item.tipo);
                    const fecha = new Date(item.fecha).toLocaleString('es-MX', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
                    li.innerHTML = `${item.texto}<span class="fecha-historial">${fecha}</span>`;
                    historialLista.appendChild(li);
                }
            }
            function guardarDatos() {
                localStorage.setItem('contadorSaldo', saldoActual.toString());
                localStorage.setItem('contadorHistorial', JSON.stringify(historial));
            }
            function obtenerMonto(tipo) {
                const mensaje = tipo === 'agregar' ? '¿Cuánto deseas agregar?' : '¿Cuánto deseas restar?';
                const inputUsuario = prompt(mensaje);
                if (inputUsuario === null) return null;
                const monto = parseFloat(inputUsuario);
                if (isNaN(monto) || monto <= 0) {
                    alert('Error: Por favor, ingresa un número positivo válido.');
                    return null;
                }
                return monto;
            }
            function agregarAlHistorial(tipo, texto) {
                const nuevoRegistro = { tipo: tipo, texto: texto, fecha: new Date().toISOString() };
                historial.push(nuevoRegistro);
            }
            btnAgregar.addEventListener('click', () => {
                const monto = obtenerMonto('agregar');
                if (monto === null) return;
                saldoActual += monto;
                agregarAlHistorial('agregado', `Agregado: +$${monto.toFixed(2)}`);
                guardarDatos();
                actualizarUI();
            });
            btnRestar.addEventListener('click', () => {
                const monto = obtenerMonto('restar');
                if (monto === null) return;
                if (monto > saldoActual) {
                    alert('Error: No puedes restar un monto mayor a tu saldo actual.');
                    return;
                }
                saldoActual -= monto;
                agregarAlHistorial('restado', `Restado: -$${monto.toFixed(2)}`);
                guardarDatos();
                actualizarUI();
            });
            actualizarUI();
        });
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registrado con éxito:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Fallo al registrar ServiceWorker:', error);
                    });
            });
        }
    </script>

</body>
</html>